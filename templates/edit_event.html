{% extends 'base.html' %}

{% block content %}
    <main class="event-form-page" role="main">
        <header class="page-header mb-4" role="banner">
            <h1 class="text-center">编辑事件</h1>
            <p class="lead text-center text-muted">更新您的VRChat记忆记录</p>
        </header>

        <div class="row justify-content-center">
            <div class="col-lg-8">
                <section class="card shadow-sm" role="region" aria-labelledby="form-heading">
                    <div class="card-body">
                        <h2 id="form-heading" class="visually-hidden">编辑事件表单</h2>
                        
                        <form method="POST" action="{{ url_for('edit_event', event_id=event.id) }}" role="form" aria-label="编辑事件表单">
                            <div class="row g-3">
                                <!-- 基本事件信息 -->
                                <fieldset class="col-md-12 mb-4" aria-labelledby="basic-info-legend" role="group">
                                    <legend id="basic-info-legend" class="h5 mb-3">基本事件信息</legend>
                                    
                                    <!-- 好友名称 -->
                                    <div class="col-md-6 mb-3">
                                        <label for="friend_name" class="form-label">
                                            <span aria-hidden="true">👥</span> 好友名称 <span class="text-danger" aria-hidden="true">*</span>
                                        </label>
                                        <input type="text" class="form-control" id="friend_name" name="friend_name" 
                                               value="{{ event.friend_name }}"
                                               required aria-required="true" autocomplete="off"
                                               aria-describedby="friend-help"
                                               placeholder="输入好友的用户名或昵称">
                                        <small id="friend-help" class="form-text text-muted">
                                            您一起玩的好友的名称
                                        </small>
                                    </div>
                                    
                                    <!-- 世界名称 -->
                                    <div class="col-md-6 mb-3">
                                        <label for="world_name" class="form-label">
                                            <span aria-hidden="true">🌍</span> 世界名称 <span class="text-danger" aria-hidden="true">*</span>
                                        </label>
                                        <input type="text" class="form-control" id="world_name" name="world_name" 
                                               value="{{ event.world.world_name }}"
                                               required aria-required="true" autocomplete="off"
                                               aria-describedby="world-help"
                                               placeholder="输入VRChat世界的名称">
                                        <small id="world-help" class="form-text text-muted">
                                            您访问的VRChat世界名称
                                        </small>
                                    </div>
                                </fieldset>

                                <!-- 世界标签 -->
                                <fieldset class="col-md-12 mb-4" aria-labelledby="tags-legend" role="group">
                                    <legend id="tags-legend" class="h5 mb-3">
                                        世界标签
                                    </legend>
                                    <div class="mb-3">
                                        <label for="world_tags" class="form-label">
                                            标签（用逗号分隔）
                                        </label>
                                        <input type="text" class="form-control" id="world_tags" name="world_tags" 
                                               value="{{ event.world.tags }}"
                                               autocomplete="off"
                                               aria-describedby="tags-help"
                                               placeholder="Social,Music,Dance,Game">
                                        <small id="tags-help" class="form-text text-muted">
                                            使用逗号分隔多个标签，例如：社交、音乐、游戏、舞蹈
                                        </small>
                                    </div>
                                </fieldset>

                                <!-- 时间信息 -->
                                <fieldset class="col-md-12 mb-4" aria-labelledby="time-legend" role="group">
                                    <legend id="time-legend" class="h5 mb-3">时间信息</legend>
                                    
                                    <div class="row">
                                        <!-- 开始时间 -->
                                        <div class="col-md-6 mb-3">
                                            <label for="start_time" class="form-label">
                                                开始时间 <span class="text-danger" aria-hidden="true">*</span>
                                            </label>
                                            <input type="datetime-local" class="form-control" id="start_time" name="start_time" 
                                                   value="{{ event.start_time_formatted }}"
                                                   required aria-required="true"
                                                   aria-describedby="start-help"
                                                   aria-label="选择开始日期和时间"
                                                   autocomplete="off">
                                            <small id="start-help" class="form-text text-muted">
                                                事件开始的日期和时间
                                            </small>
                                        </div>
                                        
                                        <!-- 结束时间 -->
                                        <div class="col-md-6 mb-3">
                                            <label for="end_time" class="form-label">
                                                结束时间 <span class="text-danger" aria-hidden="true">*</span>
                                            </label>
                                            <input type="datetime-local" class="form-control" id="end_time" name="end_time" 
                                                   value="{{ event.end_time_formatted }}"
                                                   required aria-required="true"
                                                   aria-describedby="end-help"
                                                   aria-label="选择结束日期和时间"
                                                   autocomplete="off">
                                            <small id="end-help" class="form-text text-muted">
                                                事件结束的日期和时间（必须晚于开始时间）
                                            </small>
                                        </div>
                                    </div>
                                </fieldset>

                                <!-- 备注信息 -->
                                <fieldset class="col-md-12 mb-4" aria-labelledby="notes-legend" role="group">
                                    <legend id="notes-legend" class="h5 mb-3">
                                        备注信息
                                    </legend>
                                    <div class="mb-3">
                                        <label for="notes" class="form-label">事件备注</label>
                                        <textarea class="form-control" id="notes" name="notes" rows="4"
                                                  aria-describedby="notes-help"
                                                  placeholder="添加关于此次事件的备注，例如：有趣的时刻、难忘的经历、特别的互动...">{{ event.notes or '' }}</textarea>
                                        <small id="notes-help" class="form-text text-muted">
                                            您可以记录关于此次事件的任何细节，这些备注仅对您可见
                                        </small>
                                    </div>
                                </fieldset>

                                <!-- 表单操作 -->
                                <div class="col-md-12">
                                    <div class="d-flex flex-wrap gap-2" role="toolbar" aria-label="表单操作">
                                        <button type="submit" class="btn btn-primary btn-lg flex-grow-1"
                                                aria-label="保存对事件的修改">
                                            保存修改
                                        </button>
                                        <a href="{{ url_for('event_detail', event_id=event.id) }}" class="btn btn-outline-secondary btn-lg"
                                           aria-label="取消编辑并返回事件详情">
                                            取消
                                        </a>
                                    </div>
                                    <p class="text-muted small mt-3">
                                        <span class="text-danger" aria-hidden="true">*</span> 表示必填字段
                                    </p>
                                </div>
                            </div>
                        </form>
                    </div>
                </section>
                
                <!-- 删除事件 -->
                <section class="card shadow-sm border-danger mt-4" role="region" aria-labelledby="delete-heading">
                    <div class="card-body">
                        <h3 id="delete-heading" class="card-title h5 text-danger">删除事件</h3>
                        <p class="text-muted mb-3">
                            此操作将永久删除此事件，包括所有关联的标签和备注。删除后无法恢复。
                        </p>
                        <form method="POST" action="{{ url_for('delete_event', event_id=event.id) }}" 
                              onsubmit="return confirm('确定要删除这个事件吗？此操作不可恢复。');"
                              class="d-inline">
                            <button type="submit" class="btn btn-danger"
                                    aria-label="永久删除此事件（此操作不可恢复）">
                                删除事件
                            </button>
                        </form>
                    </div>
                </section>
                
                <!-- 编辑提示 -->
                <aside class="mt-4" role="complementary" aria-label="编辑事件提示">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h3 class="h6 mb-3">💡 编辑事件提示</h3>
                            <ul class="list-unstyled small">
                                <li class="mb-2">• 更新好友名称或世界名称以保持记录的准确性</li>
                                <li class="mb-2">• 调整标签可以帮助您更好地组织和查找事件</li>
                                <li class="mb-2">• 修正时间信息有助于维护准确的时间线</li>
                                <li>• 补充备注信息可以让您在未来更好地回忆这些时刻</li>
                            </ul>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </main>
{% endblock %}